<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Using era_oa_query and build_search_string with OpenAlexR</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="era_openalex_vignette_files/libs/clipboard/clipboard.min.js"></script>
<script src="era_openalex_vignette_files/libs/quarto-html/quarto.js"></script>
<script src="era_openalex_vignette_files/libs/quarto-html/popper.min.js"></script>
<script src="era_openalex_vignette_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="era_openalex_vignette_files/libs/quarto-html/anchor.min.js"></script>
<link href="era_openalex_vignette_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="era_openalex_vignette_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="era_openalex_vignette_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="era_openalex_vignette_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="era_openalex_vignette_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article toc-left">
<div id="quarto-sidebar-toc-left" class="sidebar toc-left">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Contents</h2>
   
  <ul>
  <li><a href="#setup" id="toc-setup" class="nav-link active" data-scroll-target="#setup">1. Setup</a></li>
  <li><a href="#constructing-queries-with-build_search_string" id="toc-constructing-queries-with-build_search_string" class="nav-link" data-scroll-target="#constructing-queries-with-build_search_string">2. Constructing Queries with <code>build_search_string</code></a>
  <ul class="collapse">
  <li><a href="#list-of-terms-vs.-a-preformatted-string" id="toc-list-of-terms-vs.-a-preformatted-string" class="nav-link" data-scroll-target="#list-of-terms-vs.-a-preformatted-string">2.1 List of Terms vs.&nbsp;a Preformatted String</a></li>
  <li><a href="#a-simple-example-and-explanation-of-quote_terms" id="toc-a-simple-example-and-explanation-of-quote_terms" class="nav-link" data-scroll-target="#a-simple-example-and-explanation-of-quote_terms">2.2 A Simple Example and Explanation of <code>quote_terms</code></a></li>
  </ul></li>
  <li><a href="#using-era_oa_query-for-programmatic-searches" id="toc-using-era_oa_query-for-programmatic-searches" class="nav-link" data-scroll-target="#using-era_oa_query-for-programmatic-searches">3. Using <code>era_oa_query</code> for Programmatic Searches</a>
  <ul class="collapse">
  <li><a href="#comparing-different-geographic-filters" id="toc-comparing-different-geographic-filters" class="nav-link" data-scroll-target="#comparing-different-geographic-filters">3.1 Comparing Different Geographic Filters</a></li>
  </ul></li>
  <li><a href="#using-date-filters-to-plot-yearly-publication-counts" id="toc-using-date-filters-to-plot-yearly-publication-counts" class="nav-link" data-scroll-target="#using-date-filters-to-plot-yearly-publication-counts">3.2. Using Date Filters to Plot Yearly Publication Counts</a></li>
  <li><a href="#downloading-records" id="toc-downloading-records" class="nav-link" data-scroll-target="#downloading-records">4. Downloading Records</a></li>
  <li><a href="#understanding-max_char_limit-and-max_term" id="toc-understanding-max_char_limit-and-max_term" class="nav-link" data-scroll-target="#understanding-max_char_limit-and-max_term">5. Understanding <code>max_char_limit</code> and <code>max_term</code></a></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  </ul>
</nav>
</div>
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Using era_oa_query and build_search_string with OpenAlexR</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="setup" class="level1">
<h1>1. Setup</h1>
<p>This section installs and loads required packages, and sources the custom functions from GitHub.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Install and load openalexR if not already installed</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(openalexR)) {</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  devtools<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">"https://github.com/ropensci/openalexR"</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(openalexR)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co"># ?openalexR  # Uncomment if you want to view the help page</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Install and load pacman for package management</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(<span class="st">"pacman"</span>, <span class="at">character.only =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">install.packages</span>(<span class="st">"pacman"</span>)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(pacman)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Load data.table (via pacman)</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="fu">p_load</span>(data.table, knitr)</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Source the era_oa_query function from GitHub (sourcing once is enough)</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"https://raw.githubusercontent.com/CIAT/ERA_dev/main/R/search/era_oa_query.R"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="constructing-queries-with-build_search_string" class="level1">
<h1>2. Constructing Queries with <code>build_search_string</code></h1>
<p>Before using the full query function, we can use the helper to see how boolean queries are built.</p>
<section id="list-of-terms-vs.-a-preformatted-string" class="level2">
<h2 class="anchored" data-anchor-id="list-of-terms-vs.-a-preformatted-string">2.1 List of Terms vs.&nbsp;a Preformatted String</h2>
<p>Here we demonstrate that you can either:</p>
<ol type="a">
<li>Provide a <strong>list</strong> of terms (each block is a vector), or<br>
</li>
<li>Provide a <strong>preformatted single string</strong> for that block, containing your boolean operators.</li>
</ol>
<ol type="a">
<li>We define a named list of search blocks. Each block represents a set of terms for a particular aspect of the search. Each list level is vector of character values that will be combined with the within_block_operators argument given to the function.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>terms <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">practice =</span> <span class="fu">c</span>(<span class="st">"organic fertilizer"</span>, <span class="st">"ISFM"</span>, <span class="st">"conservation agriculture"</span>, <span class="st">"integrated soil fertility"</span>),</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">geo      =</span> <span class="fu">c</span>(<span class="st">"kenya"</span>, <span class="st">"tanzania"</span>, <span class="st">"malawi"</span>),</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">outcome  =</span> <span class="fu">c</span>(<span class="st">"yield"</span>, <span class="st">"profit margin"</span>, <span class="st">"efficiency"</span>),</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">exclude  =</span> <span class="fu">c</span>(<span class="st">"APSIM"</span>, <span class="st">"DSSAT"</span>, <span class="st">"WOFOS"</span>)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>full_query_list <span class="ot">&lt;-</span> <span class="fu">build_search_string</span>(</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">search_terms           =</span> terms,</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">within_block_operators =</span> <span class="fu">c</span>(<span class="st">"OR"</span>, <span class="st">"OR"</span>, <span class="st">"OR"</span>, <span class="st">"NOT"</span>),  <span class="co"># 'exclude' uses NOT</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">between_block_operators=</span> <span class="fu">c</span>(<span class="st">"AND"</span>, <span class="st">"AND"</span>, <span class="st">"AND"</span>),</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">quote_terms            =</span> <span class="cn">TRUE</span>,</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">max_term               =</span> <span class="dv">100</span>,</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">max_char_limit         =</span> <span class="dv">4000</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"List-of-vectors query:</span><span class="sc">\n</span><span class="st">"</span>, <span class="fu">strwrap</span>(full_query_list,<span class="at">width=</span><span class="dv">80</span>), <span class="st">"</span><span class="sc">\n\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>List-of-vectors query:
 ("organic fertilizer" OR ISFM OR "conservation agriculture" OR "integrated soil fertility") AND (kenya OR tanzania OR malawi) AND (yield OR "profit margin" OR efficiency) AND (APSIM NOT DSSAT NOT WOFOS) </code></pre>
</div>
</div>
<ol start="2" type="a">
<li>Suppose we want to provide a single preformatted string for ‘practice’ that includes OR operators, instead of a vector.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>preformatted_blocks <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">practice =</span> <span class="st">"organic fertilizer OR ISFM OR conservation agriculture OR integrated soil fertility"</span>,</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">geo      =</span> <span class="fu">c</span>(<span class="st">"kenya"</span>, <span class="st">"tanzania"</span>, <span class="st">"malawi"</span>),</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">outcome  =</span> <span class="fu">c</span>(<span class="st">"yield"</span>, <span class="st">"profit margin"</span>, <span class="st">"efficiency"</span>),</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">exclude  =</span> <span class="fu">c</span>(<span class="st">"APSIM"</span>, <span class="st">"DSSAT"</span>, <span class="st">"WOFOS"</span>)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>full_query_preformatted <span class="ot">&lt;-</span> <span class="fu">build_search_string</span>(</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">search_terms           =</span> preformatted_blocks,</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">within_block_operators =</span> <span class="fu">c</span>(<span class="st">"OR"</span>, <span class="st">"OR"</span>, <span class="st">"OR"</span>, <span class="st">"NOT"</span>),</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">between_block_operators=</span> <span class="fu">c</span>(<span class="st">"AND"</span>, <span class="st">"AND"</span>, <span class="st">"AND"</span>),</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">quote_terms            =</span> <span class="cn">TRUE</span>,</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">max_term               =</span> <span class="dv">100</span>,</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">max_char_limit         =</span> <span class="dv">4000</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Single-string block for 'practice':</span><span class="sc">\n</span><span class="st">"</span>, <span class="fu">strwrap</span>(full_query_preformatted,<span class="at">width=</span><span class="dv">80</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Single-string block for 'practice':
 ("organic fertilizer" OR "ISFM" OR "conservation agriculture" OR "integrated soil fertility" OR NA) AND (kenya OR tanzania OR malawi) AND (yield OR "profit margin" OR efficiency) AND (APSIM NOT DSSAT NOT WOFOS) </code></pre>
</div>
</div>
</section>
<section id="a-simple-example-and-explanation-of-quote_terms" class="level2">
<h2 class="anchored" data-anchor-id="a-simple-example-and-explanation-of-quote_terms">2.2 A Simple Example and Explanation of <code>quote_terms</code></h2>
<p><code>quote_terms</code> is a parameter that, when set to <code>TRUE</code>, makes the function place multi-word terms in quotes. For example, <code>"organic fertilizer"</code> becomes <code>"(\"organic fertilizer\")"</code>, ensuring the OpenAlex API treats it as an exact phrase rather than separate words “organic” and “fertilizer.”</p>
<p>You can provide:</p>
<ul>
<li><strong>A list</strong> of vectors (like in Section 2), where each vector is combined within a block (e.g., <code>OR</code>, <code>AND</code>, <code>NOT</code>), and blocks are combined between themselves.</li>
<li><strong>A single string</strong> that already includes Boolean operators. For instance: <code>"organic fertilizer OR ISFM OR conservation agriculture"</code>. If you do this and <code>quote_terms = TRUE</code>, the function will try to parse and quote non-operator tokens. Otherwise, if the string is fully boolean and you don’t want quoting, set <code>quote_terms = FALSE</code>.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a simple search   </span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>test_blocks <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">practice =</span> <span class="fu">c</span>(<span class="st">"organic fertilizer"</span>, <span class="st">"ISFM"</span>),</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">geo      =</span> <span class="fu">c</span>(<span class="st">"kenya"</span>, <span class="st">"tanzania"</span>)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>test_query_T <span class="ot">&lt;-</span> <span class="fu">build_search_string</span>(</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">search_terms           =</span> test_blocks,</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">within_block_operators =</span> <span class="fu">c</span>(<span class="st">"OR"</span>, <span class="st">"OR"</span>),</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">between_block_operators=</span> <span class="st">"AND"</span>,</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">quote_terms            =</span> <span class="cn">TRUE</span>   <span class="co"># place multi-word terms in quotes</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Resulting string when quote_terms is TRUE</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>test_query_T</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "(\"organic fertilizer\" OR ISFM) AND (kenya OR tanzania)"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>test_query_F <span class="ot">&lt;-</span> <span class="fu">build_search_string</span>(</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">search_terms           =</span> test_blocks,</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">within_block_operators =</span> <span class="fu">c</span>(<span class="st">"OR"</span>, <span class="st">"OR"</span>),</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">between_block_operators=</span> <span class="st">"AND"</span>,</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">quote_terms            =</span> F  <span class="co"># place multi-word terms in quotes</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Resulting string when quote_terms is FALSE</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>test_query_F</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "(organic fertilizer OR ISFM) AND (kenya OR tanzania)"</code></pre>
</div>
</div>
<p>This is impact on the search results that are returned:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>test_query_T_result <span class="ot">&lt;-</span> <span class="fu">era_oa_query</span>(</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">search_terms =</span> test_blocks,</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">from_date    =</span> <span class="st">"2010-01-01"</span>,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">to_date      =</span> <span class="st">"2023-12-31"</span>,</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">download         =</span> <span class="cn">FALSE</span>,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">within_block_operators =</span> <span class="fu">c</span>(<span class="st">"OR"</span>, <span class="st">"OR"</span>),</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">between_block_operators=</span> <span class="st">"AND"</span>,</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">quote_terms            =</span> <span class="cn">TRUE</span>,</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">verbose=</span>F</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>)<span class="sc">$</span>search_hits</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Search hits quote terms:</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>test_query_T_result</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 121</code></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>test_query_F_result <span class="ot">&lt;-</span> <span class="fu">era_oa_query</span>(</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">search_terms =</span> test_blocks,</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">from_date    =</span> <span class="st">"2010-01-01"</span>,</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">to_date      =</span> <span class="st">"2023-12-31"</span>,</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">download         =</span> <span class="cn">FALSE</span>,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">within_block_operators =</span> <span class="fu">c</span>(<span class="st">"OR"</span>, <span class="st">"OR"</span>),</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">between_block_operators=</span> <span class="st">"AND"</span>,</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">quote_terms            =</span> <span class="cn">FALSE</span>,</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">verbose=</span>F</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>)<span class="sc">$</span>search_hits</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Search hits without quote terms:</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>test_query_F_result</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3258</code></pre>
</div>
</div>
</section>
</section>
<section id="using-era_oa_query-for-programmatic-searches" class="level1">
<h1>3. Using <code>era_oa_query</code> for Programmatic Searches</h1>
<p>We now use the <code>era_oa_query</code> wrapper function to query OpenAlex. To being with we set <code>download = FALSE</code> to return hit counts only, rather than downloading the full records. This is useful for formulating searches quickly withoutn having to download huge amounts of rich bibliographic data from the OA database.</p>
<section id="comparing-different-geographic-filters" class="level2">
<h2 class="anchored" data-anchor-id="comparing-different-geographic-filters">3.1 Comparing Different Geographic Filters</h2>
<p><strong>Understanding the <code>continent</code> Argument in <code>era_oa_query</code>:</strong></p>
<p>The <code>continent</code> parameter in the <code>era_oa_query</code> function is used to filter search results based on the geographical location of the authors’ institutions. When you set, for example, <code>continent = "Africa"</code>, this value is passed to the OpenAlex API via the argument <code>authorships.institutions.continent</code>. This means that only works where at least one author is affiliated with an institution located in Africa will be returned.</p>
<p>In other words, using the <code>continent</code> argument does not search for geographic terms within the paper’s title or abstract. Instead, it leverages OpenAlex’s curated institutional metadata to filter results based on where the authors’ institutions are located. This allows you to focus on research outputs that originate from a specific region, which is particularly useful for regional analyses.</p>
<p>Below, we define <strong>six</strong> variants for African regions:</p>
<ol type="1">
<li><strong>EastAfrica</strong>: A set of East African countries (geo block).</li>
<li><strong>WestAfrica</strong>: West African countries.</li>
<li><strong>SouthernAfrica</strong>: Southern African countries.</li>
<li><strong>NorthernAfrica</strong>: Northern African countries.</li>
<li><strong>AfricaContinent</strong>: No <code>geo</code> block, but we pass <code>continent = "Africa"</code>.</li>
<li><strong>AfricaGeo</strong>: A large <code>geo</code> block listing many African countries.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's define some representative countries for each region:</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Northern Africa (AU)</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>northern_africa <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Algeria"</span>,<span class="st">"Egypt"</span>,<span class="st">"Libya"</span>,<span class="st">"Mauritania"</span>,<span class="st">"Morocco"</span>,<span class="st">"Tunisia"</span>)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="co"># West Africa (AU)</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>west_africa <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Benin"</span>,<span class="st">"Burkina Faso"</span>,<span class="st">"Cabo Verde"</span>,<span class="st">"Côte d’Ivoire"</span>,<span class="st">"The Gambia"</span>,<span class="st">"Ghana"</span>,<span class="st">"Guinea"</span>,<span class="st">"Guinea-Bissau"</span>,<span class="st">"Liberia"</span>,<span class="st">"Mali"</span>,<span class="st">"Niger"</span>,<span class="st">"Nigeria"</span>,<span class="st">"Senegal"</span>,<span class="st">"Sierra Leone"</span>,<span class="st">"Togo"</span>)</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="co"># East Africa (AU)</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>east_africa <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Comoros"</span>,<span class="st">"Djibouti"</span>,<span class="st">"Eritrea"</span>,<span class="st">"Ethiopia"</span>,<span class="st">"Kenya"</span>,<span class="st">"Madagascar"</span>,<span class="st">"Mauritius"</span>,<span class="st">"Rwanda"</span>,<span class="st">"Seychelles"</span>,<span class="st">"Somalia"</span>,<span class="st">"South Sudan"</span>,<span class="st">"Sudan"</span>,<span class="st">"Tanzania"</span>,<span class="st">"Uganda"</span>)</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Southern Africa (AU)</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>southern_africa <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Botswana"</span>,<span class="st">"Eswatini"</span>,<span class="st">"Lesotho"</span>,<span class="st">"Malawi"</span>,<span class="st">"Mozambique"</span>,<span class="st">"Namibia"</span>,<span class="st">"South Africa"</span>,<span class="st">"Zambia"</span>,<span class="st">"Zimbabwe"</span>)</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a><span class="co"># For AfricaGeo, we combine them all (this is just an example subset, not exhaustive).</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>all_africa <span class="ot">&lt;-</span> <span class="fu">c</span>(east_africa, west_africa, southern_africa, northern_africa)</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>search_variants <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">EastAfrica =</span> <span class="fu">list</span>(</span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">practice =</span> <span class="fu">c</span>(<span class="st">"organic fertilizer"</span>, <span class="st">"ISFM"</span>, <span class="st">"conservation agriculture"</span>),</span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">geo      =</span> east_africa</span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">WestAfrica =</span> <span class="fu">list</span>(</span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">practice =</span> <span class="fu">c</span>(<span class="st">"organic fertilizer"</span>, <span class="st">"ISFM"</span>, <span class="st">"conservation agriculture"</span>),</span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">geo      =</span> west_africa</span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">SouthernAfrica =</span> <span class="fu">list</span>(</span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">practice =</span> <span class="fu">c</span>(<span class="st">"organic fertilizer"</span>, <span class="st">"ISFM"</span>, <span class="st">"conservation agriculture"</span>),</span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">geo      =</span> southern_africa</span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a>  <span class="at">NorthernAfrica =</span> <span class="fu">list</span>(</span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">practice =</span> <span class="fu">c</span>(<span class="st">"organic fertilizer"</span>, <span class="st">"ISFM"</span>, <span class="st">"conservation agriculture"</span>),</span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">geo      =</span> northern_africa</span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a>  <span class="at">AfricaContinent =</span> <span class="fu">list</span>(</span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">practice =</span> <span class="fu">c</span>(<span class="st">"organic fertilizer"</span>, <span class="st">"ISFM"</span>, <span class="st">"conservation agriculture"</span>)</span>
<span id="cb14-36"><a href="#cb14-36" aria-hidden="true" tabindex="-1"></a>    <span class="co"># We'll pass continent="Africa"</span></span>
<span id="cb14-37"><a href="#cb14-37" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb14-38"><a href="#cb14-38" aria-hidden="true" tabindex="-1"></a>  <span class="at">AfricaGeo =</span> <span class="fu">list</span>(</span>
<span id="cb14-39"><a href="#cb14-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">practice =</span> <span class="fu">c</span>(<span class="st">"organic fertilizer"</span>, <span class="st">"ISFM"</span>, <span class="st">"conservation agriculture"</span>),</span>
<span id="cb14-40"><a href="#cb14-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">geo      =</span> all_africa</span>
<span id="cb14-41"><a href="#cb14-41" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb14-42"><a href="#cb14-42" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb14-43"><a href="#cb14-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-44"><a href="#cb14-44" aria-hidden="true" tabindex="-1"></a>results_list <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb14-45"><a href="#cb14-45" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (nm <span class="cf">in</span> <span class="fu">names</span>(search_variants)) {</span>
<span id="cb14-46"><a href="#cb14-46" aria-hidden="true" tabindex="-1"></a>  blocks <span class="ot">&lt;-</span> search_variants[[nm]]</span>
<span id="cb14-47"><a href="#cb14-47" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-48"><a href="#cb14-48" aria-hidden="true" tabindex="-1"></a>  <span class="co"># For "AfricaContinent", pass continent = "Africa", else NULL</span></span>
<span id="cb14-49"><a href="#cb14-49" aria-hidden="true" tabindex="-1"></a>  cont <span class="ot">&lt;-</span> <span class="cf">if</span> (nm <span class="sc">==</span> <span class="st">"AfricaContinent"</span>) <span class="st">"Africa"</span> <span class="cf">else</span> <span class="cn">NULL</span></span>
<span id="cb14-50"><a href="#cb14-50" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-51"><a href="#cb14-51" aria-hidden="true" tabindex="-1"></a>  res <span class="ot">&lt;-</span> <span class="fu">era_oa_query</span>(</span>
<span id="cb14-52"><a href="#cb14-52" aria-hidden="true" tabindex="-1"></a>    <span class="at">search_terms =</span> blocks,</span>
<span id="cb14-53"><a href="#cb14-53" aria-hidden="true" tabindex="-1"></a>    <span class="at">from_date    =</span> <span class="st">"2020-01-01"</span>,</span>
<span id="cb14-54"><a href="#cb14-54" aria-hidden="true" tabindex="-1"></a>    <span class="at">to_date      =</span> <span class="st">"2023-12-31"</span>,</span>
<span id="cb14-55"><a href="#cb14-55" aria-hidden="true" tabindex="-1"></a>    <span class="at">continent    =</span> cont,</span>
<span id="cb14-56"><a href="#cb14-56" aria-hidden="true" tabindex="-1"></a>    <span class="at">download     =</span> <span class="cn">FALSE</span>,</span>
<span id="cb14-57"><a href="#cb14-57" aria-hidden="true" tabindex="-1"></a>    <span class="at">full         =</span> <span class="cn">FALSE</span>,</span>
<span id="cb14-58"><a href="#cb14-58" aria-hidden="true" tabindex="-1"></a>    <span class="at">within_block_operators =</span> <span class="fu">rep</span>(<span class="st">"OR"</span>, <span class="fu">length</span>(blocks)),  <span class="co"># Combine terms in each block with OR</span></span>
<span id="cb14-59"><a href="#cb14-59" aria-hidden="true" tabindex="-1"></a>    <span class="at">between_block_operators=</span> <span class="st">"AND"</span>,</span>
<span id="cb14-60"><a href="#cb14-60" aria-hidden="true" tabindex="-1"></a>    <span class="at">quote_terms            =</span> <span class="cn">TRUE</span>,</span>
<span id="cb14-61"><a href="#cb14-61" aria-hidden="true" tabindex="-1"></a>    <span class="at">verbose=</span>F</span>
<span id="cb14-62"><a href="#cb14-62" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb14-63"><a href="#cb14-63" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-64"><a href="#cb14-64" aria-hidden="true" tabindex="-1"></a>  results_list[[nm]] <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb14-65"><a href="#cb14-65" aria-hidden="true" tabindex="-1"></a>    <span class="at">region     =</span> nm,</span>
<span id="cb14-66"><a href="#cb14-66" aria-hidden="true" tabindex="-1"></a>    <span class="at">query      =</span> res<span class="sc">$</span>query,</span>
<span id="cb14-67"><a href="#cb14-67" aria-hidden="true" tabindex="-1"></a>    <span class="at">hits       =</span> res<span class="sc">$</span>search_hits</span>
<span id="cb14-68"><a href="#cb14-68" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb14-69"><a href="#cb14-69" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb14-70"><a href="#cb14-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-71"><a href="#cb14-71" aria-hidden="true" tabindex="-1"></a>all_res <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, results_list)</span>
<span id="cb14-72"><a href="#cb14-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-73"><a href="#cb14-73" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">8</span>, <span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">2</span>))</span>
<span id="cb14-74"><a href="#cb14-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-75"><a href="#cb14-75" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(</span>
<span id="cb14-76"><a href="#cb14-76" aria-hidden="true" tabindex="-1"></a>  all_res<span class="sc">$</span>hits,</span>
<span id="cb14-77"><a href="#cb14-77" aria-hidden="true" tabindex="-1"></a>  <span class="at">names.arg =</span> all_res<span class="sc">$</span>region,</span>
<span id="cb14-78"><a href="#cb14-78" aria-hidden="true" tabindex="-1"></a>  <span class="at">main =</span> <span class="st">"OpenAlex Hits by African Region Filter"</span>,</span>
<span id="cb14-79"><a href="#cb14-79" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlab =</span> <span class="st">"Region"</span>,</span>
<span id="cb14-80"><a href="#cb14-80" aria-hidden="true" tabindex="-1"></a>  <span class="at">ylab =</span> <span class="st">"Number of Hits"</span>,</span>
<span id="cb14-81"><a href="#cb14-81" aria-hidden="true" tabindex="-1"></a>  <span class="at">las =</span> <span class="dv">2</span>,        </span>
<span id="cb14-82"><a href="#cb14-82" aria-hidden="true" tabindex="-1"></a>  <span class="at">cex.names =</span> <span class="fl">0.8</span> </span>
<span id="cb14-83"><a href="#cb14-83" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="era_openalex_vignette_files/figure-html/geo-searches-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>We can see the using the <code>continent="Africa"</code> argument results in more search hits than a geographic term of African country names.</p>
<p>According to the OpenAlex API, the authorships.institutions.continent filter recognizes the following continent values: 1. <code>Africa</code> 2. <code>Antarctica</code> 3. <code>Asia</code> 4. <code>Europe</code> 5. <code>North America</code> 6. <code>Oceania</code> 7. <code>South America</code></p>
<p>These correspond to standard continent names. You won’t see them explicitly listed in one place in the official OpenAlex documentation, but these are the recognized values in the data. You can see references to them by exploring institutional records in the OpenAlex dataset or by checking examples in the OpenAlex docs under “Filter entity lists.” If you specify any other string, the API will simply not match any institutions.</p>
</section>
</section>
<section id="using-date-filters-to-plot-yearly-publication-counts" class="level1">
<h1>3.2. Using Date Filters to Plot Yearly Publication Counts</h1>
<p>We can loop over a set of years to get hit counts for each year and then plot the trend.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>regions <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">East =</span> east_africa,</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">West =</span> west_africa,</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">North =</span> northern_africa,</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">South =</span> southern_africa</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>years <span class="ot">&lt;-</span> <span class="dv">2005</span><span class="sc">:</span><span class="dv">2024</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a data frame to hold hit counts for each region and year</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>region_year_hits <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">year =</span> <span class="fu">rep</span>(years, <span class="at">times =</span> <span class="fu">length</span>(regions)),</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">region =</span> <span class="fu">rep</span>(<span class="fu">names</span>(regions), <span class="at">each =</span> <span class="fu">length</span>(years)),</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">hits =</span> <span class="cn">NA_integer_</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop over each region and year, running era_oa_query and storing the hit count.</span></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (r <span class="cf">in</span> <span class="fu">names</span>(regions)) {</span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (y <span class="cf">in</span> years) {</span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>    blocks <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">practice =</span> <span class="st">"conservation agriculture"</span>,</span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">geo      =</span> regions[[r]]</span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a>    start_date <span class="ot">&lt;-</span> <span class="fu">paste0</span>(y, <span class="st">"-01-01"</span>)</span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a>    end_date   <span class="ot">&lt;-</span> <span class="fu">paste0</span>(y, <span class="st">"-12-31"</span>)</span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a>    res <span class="ot">&lt;-</span> <span class="fu">era_oa_query</span>(</span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a>      <span class="at">search_terms           =</span> blocks,</span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a>      <span class="at">from_date              =</span> start_date,</span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a>      <span class="at">to_date                =</span> end_date,</span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true" tabindex="-1"></a>      <span class="at">download               =</span> <span class="cn">FALSE</span>,</span>
<span id="cb15-33"><a href="#cb15-33" aria-hidden="true" tabindex="-1"></a>      <span class="at">full                   =</span> <span class="cn">FALSE</span>,</span>
<span id="cb15-34"><a href="#cb15-34" aria-hidden="true" tabindex="-1"></a>      <span class="at">within_block_operators =</span> <span class="fu">c</span>(<span class="st">"OR"</span>, <span class="st">"OR"</span>),</span>
<span id="cb15-35"><a href="#cb15-35" aria-hidden="true" tabindex="-1"></a>      <span class="at">between_block_operators=</span> <span class="st">"AND"</span>,</span>
<span id="cb15-36"><a href="#cb15-36" aria-hidden="true" tabindex="-1"></a>      <span class="at">quote_terms            =</span> <span class="cn">TRUE</span>,</span>
<span id="cb15-37"><a href="#cb15-37" aria-hidden="true" tabindex="-1"></a>      <span class="at">verbose                =</span> <span class="cn">FALSE</span></span>
<span id="cb15-38"><a href="#cb15-38" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb15-39"><a href="#cb15-39" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb15-40"><a href="#cb15-40" aria-hidden="true" tabindex="-1"></a>    region_year_hits<span class="sc">$</span>hits[region_year_hits<span class="sc">$</span>region <span class="sc">==</span> r <span class="sc">&amp;</span> region_year_hits<span class="sc">$</span>year <span class="sc">==</span> y] <span class="ot">&lt;-</span> res<span class="sc">$</span>search_hits</span>
<span id="cb15-41"><a href="#cb15-41" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb15-42"><a href="#cb15-42" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb15-43"><a href="#cb15-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-44"><a href="#cb15-44" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the results with different colors for each region</span></span>
<span id="cb15-45"><a href="#cb15-45" aria-hidden="true" tabindex="-1"></a>colors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"red"</span>, <span class="st">"blue"</span>, <span class="st">"green"</span>, <span class="st">"purple"</span>)</span>
<span id="cb15-46"><a href="#cb15-46" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(years, region_year_hits<span class="sc">$</span>hits[region_year_hits<span class="sc">$</span>region <span class="sc">==</span> <span class="st">"East"</span>],</span>
<span id="cb15-47"><a href="#cb15-47" aria-hidden="true" tabindex="-1"></a>     <span class="at">type =</span> <span class="st">"b"</span>, <span class="at">col =</span> colors[<span class="dv">1</span>], <span class="at">pch =</span> <span class="dv">19</span>, <span class="at">lwd =</span> <span class="dv">2</span>,</span>
<span id="cb15-48"><a href="#cb15-48" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Year"</span>, <span class="at">ylab =</span> <span class="st">"Number of Publications"</span>,</span>
<span id="cb15-49"><a href="#cb15-49" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"Publications on 'Conservation Agriculture' by African Region (1995-2024)"</span>,</span>
<span id="cb15-50"><a href="#cb15-50" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylim =</span> <span class="fu">range</span>(region_year_hits<span class="sc">$</span>hits, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb15-51"><a href="#cb15-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-52"><a href="#cb15-52" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(years, region_year_hits<span class="sc">$</span>hits[region_year_hits<span class="sc">$</span>region <span class="sc">==</span> <span class="st">"West"</span>],</span>
<span id="cb15-53"><a href="#cb15-53" aria-hidden="true" tabindex="-1"></a>      <span class="at">type =</span> <span class="st">"b"</span>, <span class="at">col =</span> colors[<span class="dv">2</span>], <span class="at">pch =</span> <span class="dv">19</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb15-54"><a href="#cb15-54" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(years, region_year_hits<span class="sc">$</span>hits[region_year_hits<span class="sc">$</span>region <span class="sc">==</span> <span class="st">"North"</span>],</span>
<span id="cb15-55"><a href="#cb15-55" aria-hidden="true" tabindex="-1"></a>      <span class="at">type =</span> <span class="st">"b"</span>, <span class="at">col =</span> colors[<span class="dv">3</span>], <span class="at">pch =</span> <span class="dv">19</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb15-56"><a href="#cb15-56" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(years, region_year_hits<span class="sc">$</span>hits[region_year_hits<span class="sc">$</span>region <span class="sc">==</span> <span class="st">"South"</span>],</span>
<span id="cb15-57"><a href="#cb15-57" aria-hidden="true" tabindex="-1"></a>      <span class="at">type =</span> <span class="st">"b"</span>, <span class="at">col =</span> colors[<span class="dv">4</span>], <span class="at">pch =</span> <span class="dv">19</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb15-58"><a href="#cb15-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-59"><a href="#cb15-59" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"topleft"</span>, <span class="at">legend =</span> <span class="fu">names</span>(regions), <span class="at">col =</span> colors, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">pch =</span> <span class="dv">19</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="era_openalex_vignette_files/figure-html/date-filter-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="downloading-records" class="level1">
<h1>4. Downloading Records</h1>
<p>Here we show how you can use the <code>era_oa_query</code> function to download minimal fields (faster with only doi and title fields) vs.&nbsp;full fields (slower with all bibliographic fields).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>my_blocks <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">practice =</span> <span class="fu">c</span>(<span class="st">"organic fertilizer"</span>),</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">geo      =</span> <span class="fu">c</span>(<span class="st">"kenya"</span>),</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">outcome  =</span> <span class="fu">c</span>(<span class="st">"yield"</span>, <span class="st">"profit margin"</span>)</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Download minimal fields (title, doi)</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>res_min <span class="ot">&lt;-</span> <span class="fu">era_oa_query</span>(</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">search_terms =</span> my_blocks,</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">from_date    =</span> <span class="st">"2020-01-01"</span>,</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">to_date      =</span> <span class="st">"2023-12-31"</span>,</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">download     =</span> <span class="cn">TRUE</span>,</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">full         =</span> <span class="cn">FALSE</span>,</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">quote_terms  =</span> <span class="cn">TRUE</span></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Token count = 4 
Search hits = 6 
Downloading query results...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">head</span>(res_min<span class="sc">$</span>results,<span class="dv">5</span>),<span class="at">caption=</span><span class="st">"Title and doi only downloaded"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Title and doi only downloaded</caption>
<colgroup>
<col style="width: 76%">
<col style="width: 23%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">title</th>
<th style="text-align: left;">doi</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">The influence of organic and inorganic nutrient inputs on soil organic carbon functional groups content and maize yields</td>
<td style="text-align: left;">https://doi.org/10.1016/j.heliyon.2021.e07881</td>
</tr>
<tr class="even">
<td style="text-align: left;">Effects of a One-Time Organic Fertilizer Application on Long-Term Crop and Residue Yields, and Soil Quality Measurements Using Biointensive Agriculture</td>
<td style="text-align: left;">https://doi.org/10.3389/fsufs.2020.00067</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Efficacy Evaluation of Organic Fertilizers on Growth, Yield and Quality Parameters of French Beans, Maize and Kale in Different Counties of Kenya</td>
<td style="text-align: left;">https://doi.org/10.9734/ijpss/2023/v35i132987</td>
</tr>
<tr class="even">
<td style="text-align: left;">Assessment of Factors that Limit Optimal Use of Organic Fertilizers in Subsistence Food Production in Vihiga County, Kenya</td>
<td style="text-align: left;">https://doi.org/10.9734/ijecc/2021/v11i1130545</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Effect of Cropping System and Nitrogen on Maize and Soy Bean Yields in Western Kenya</td>
<td style="text-align: left;">https://doi.org/10.5539/sar.v9n3p39</td>
</tr>
</tbody>
</table>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Download full fields (including abstracts)</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>res_full <span class="ot">&lt;-</span> <span class="fu">era_oa_query</span>(</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">search_terms =</span> my_blocks,</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">from_date    =</span> <span class="st">"2020-01-01"</span>,</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">to_date      =</span> <span class="st">"2023-12-31"</span>,</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">download     =</span> <span class="cn">TRUE</span>,</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">full         =</span> <span class="cn">TRUE</span>,</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">quote_terms  =</span> <span class="cn">TRUE</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Token count = 4 
Search hits = 6 
Downloading query results...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">head</span>(res_full<span class="sc">$</span>results,<span class="dv">1</span>),<span class="at">caption=</span><span class="st">"Complete record downloaded"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Complete record downloaded</caption>
<colgroup>
<col style="width: 1%">
<col style="width: 4%">
<col style="width: 85%">
<col style="width: 1%">
<col style="width: 1%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 4%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">id</th>
<th style="text-align: left;">display_name</th>
<th style="text-align: left;">ab</th>
<th style="text-align: left;">doi</th>
<th style="text-align: left;">url</th>
<th style="text-align: right;">relevance_score</th>
<th style="text-align: left;">is_oa</th>
<th style="text-align: left;">language</th>
<th style="text-align: left;">type</th>
<th style="text-align: left;">publication_date</th>
<th style="text-align: left;">authors</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">https://openalex.org/W3197607097</td>
<td style="text-align: left;">The influence of organic and inorganic nutrient inputs on soil organic carbon functional groups content and maize yields</td>
<td style="text-align: left;">Locally available organic inputs to soil, solely or in combination with inorganic fertilizers, are used to reverse declining soil fertility and improve soil organic matter content (SOM) in smallholder farms of most Sub-Saharan Africa (SSA) countries. Soil organic matter characterization can indicate soil organic input, carbon (C) sequestration potential, or even an authentication tool for soil C dynamics in C stocks accounting. This study determined the effects of the long-term application of selected integrated soil fertility management (ISFM) technologies on SOM functional group composition and maize yields. The study was carried out on an ongoing long-term soil fertility field experiment established in 2004 in Mbeere South sub-county, the drier part of upper Eastern Kenya. The experimental design was a randomized complete block design. The ISFM treatments were 60 kg ha−1 nitrogen (N) from goat manure (GM60); 30 kg ha−1 inorganic N fertilizer (IF30); 60 kg ha−1 inorganic N fertilizer (IF60); GM30+IF30; 90 kg ha−1 inorganic N fertilizer (IF90); 60 kg ha−1 N from lantana (Lantana camara) (LC60); LC30+IF30; 60 kg ha−1 N from mucuna beans (Mucuna pruriens) (MP60); MP30+IF30; 60 kg ha−1 N from Mexican sunflower (Tithonia diversifolia) (TD60); TD30+IF30, and a control with no inputs. The C compositions of ground soil samples and organic amendments were analyzed using 13C solid-state NMR. The GM60, GM30+IF30, LC60, and TD60 treatments had much higher Alkyl and O-Alkyl C SOM functional groups than the control and other treatments. The average soil C for the control was 7.47 mg kg−1 and ranged from 5.03 to 7.37, 9.57 to 18.77, and 7.03–14.50 mg kg−1 for inorganic fertilizers, organic fertilizers, and organic + inorganic fertilizers, respectively. The mean grain yield for the control was 0.56 Mg ha−1 and ranged from 1.51 to 1.99, 1.94 to 4.16, and 2.98–4.60 Mg ha−1 for inorganic fertilizers, organic fertilizers, and organic + inorganic fertilizers, respectively. The results showed that a long-term application of sole organic fertilizers or combined with inorganic fertilizers increases maize yield and soil C sequestration potential. The increase was attributed to high Alkyl and O-Alkyl C SOM functional groups. Hence, knowing the C fraction content of organic inputs is vital in determining the best-fit management technologies for ameliorating soil fertility and sustaining and/or improving crop yields.</td>
<td style="text-align: left;">https://doi.org/10.1016/j.heliyon.2021.e07881</td>
<td style="text-align: left;">https://doi.org/10.1016/j.heliyon.2021.e07881</td>
<td style="text-align: right;">14.03345</td>
<td style="text-align: left;">TRUE</td>
<td style="text-align: left;">en</td>
<td style="text-align: left;">article</td>
<td style="text-align: left;">2021-08-01</td>
<td style="text-align: left;">Macharia Mohamed Ndung’u;Lucy W. Ngatia;Richard N. Onwonga;Monicah Mucheru‐Muna;Riqiang Fu;Daniel N. Moriasi;Felix K. Ngetich</td>
</tr>
</tbody>
</table>
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The search details are also returned</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(res_min<span class="sc">$</span>meta_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 18%">
<col style="width: 73%">
<col style="width: 3%">
<col style="width: 4%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">query</th>
<th style="text-align: left;">api_endpoint</th>
<th style="text-align: right;">search_hits</th>
<th style="text-align: left;">date_search_ran</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(“organic fertilizer”) AND (kenya) AND (yield OR “profit margin”)</td>
<td style="text-align: left;">https://api.openalex.org/works?filter=title_and_abstract.search%3A%28%22organic%20fertilizer%22%29%20AND%20%28kenya%29%20AND%20%28yield%20OR%20%22profit%20margin%22%29%2Cfrom_publication_date%3A2020-01-01%2Cto_publication_date%3A2023-12-31&amp;select=title,doi</td>
<td style="text-align: right;">6</td>
<td style="text-align: left;">2025-02-18</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="understanding-max_char_limit-and-max_term" class="level1">
<h1>5. Understanding <code>max_char_limit</code> and <code>max_term</code></h1>
<ul>
<li><p><strong>max_char_limit</strong>:<br>
This parameter limits the maximum number of characters allowed in the final API URL. If your query is too large, you may exceed URL length limits. The function stops if the endpoint URL is longer than this value.</p></li>
<li><p><strong>max_term</strong>:<br>
This parameter is used by <code>build_search_string</code> (which employs advanced token splitting) to warn if the query is too big. Large queries can cause performance issues or exceed the API constraints.</p></li>
</ul>
<p>These parameters help manage limitations of the OpenAlex API, ensuring your queries remain within acceptable bounds.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a dummy search list with a large search string that is too long</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>dummy_terms_long <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">dummy =</span> <span class="fu">rep</span>(<span class="st">"extremely long winded search term that yields a search string that is waaaaaaaaaaaay too long"</span>, <span class="dv">99</span>)</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>dummy_result_long <span class="ot">&lt;-</span> <span class="fu">tryCatch</span>(</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">era_oa_query</span>(</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">search_terms   =</span> dummy_terms_long,</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">from_date      =</span> <span class="st">"2020-01-01"</span>,</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">to_date        =</span> <span class="st">"2023-12-31"</span>,</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">download       =</span> <span class="cn">FALSE</span>,</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">full           =</span> <span class="cn">FALSE</span>,</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">quote_terms    =</span> <span class="cn">TRUE</span>,</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">max_term       =</span> <span class="dv">100</span>,</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">max_char_limit =</span> <span class="dv">4000</span></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">error =</span> <span class="cf">function</span>(e) e</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Token count = 99 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>dummy_result_long<span class="sc">$</span>message</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Encoded search string has 13518 characters, which exceeds the maximum allowed (4000)."</code></pre>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a dummy search list with a large search string that has too many terms</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>dummy_terms_many <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">dummy =</span> <span class="fu">rep</span>(<span class="st">"a"</span>, <span class="dv">300</span>)  <span class="co"># 300 terms in one block</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>dummy_result_many <span class="ot">&lt;-</span> <span class="fu">tryCatch</span>(</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">era_oa_query</span>(</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">search_terms   =</span> dummy_terms_many,</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">from_date      =</span> <span class="st">"2020-01-01"</span>,</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">to_date        =</span> <span class="st">"2023-12-31"</span>,</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">download       =</span> <span class="cn">FALSE</span>,</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">full           =</span> <span class="cn">FALSE</span>,</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">quote_terms    =</span> <span class="cn">TRUE</span>,</span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">max_term       =</span> <span class="dv">100</span>,</span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">max_char_limit =</span> <span class="dv">4000</span></span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">error =</span> <span class="cf">function</span>(e) e</span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Token count = 300 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>dummy_result_many<span class="sc">$</span>message</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Number of terms (300) exceeds the maximum allowed (100)."</code></pre>
</div>
</div>
</section>
<section id="summary" class="level1">
<h1>Summary</h1>
<ul>
<li><p><strong>build_search_string</strong>:<br>
Allows you to flexibly build boolean queries from lists of blocks, specifying within‐ and between‐block operators, and optionally quoting multi‐word terms. You can also pass a single string containing Boolean logic.</p></li>
<li><p><strong>era_oa_query</strong>:<br>
Wraps the query construction and uses OpenAlexR to retrieve results. It supports date filters, continent filters, minimal/full downloads, and checks on query length.</p></li>
</ul>
<p>You can experiment with different filters, date ranges, and download options to tailor your search to your needs.</p>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>